{% extends 'dashboard/base.html' %}

{% block content %}

    <h3 class="display-3">Search your building by address:</h3>

    <label for="addressSearch">
        <input type="search" class="addressSearch">
    </label>

    <div class="addressListDiv" id="addressListDiv">
    </div>


    <script>
            let cs = 0

        $('.addressSearch').keyup(updateCount);
        $('.addressSearch').keydown(updateCount);
        $('.addressSearch').on('search', updateCount);


        function updateCount() {
            cs = $(this).val().length;

            csval = $(this).val();

            $('#characters').text(cs);

            if (cs === 0) {

                let addListDiv = document.getElementById('addressListDiv')

                while (addListDiv.firstChild) {
                    addListDiv.removeChild(addListDiv.firstChild);
                }

            }

            if (cs > 3) {

                let apicall = 'https://geosearch.planninglabs.nyc/v2/autocomplete?text=' + csval;

                let request = new XMLHttpRequest();

                request.open('GET', apicall, true);

                request.onload = function () {

                    let data = JSON.parse(this.response);

                    let addListDiv = document.getElementById('addressListDiv')

                    while (addListDiv.firstChild) {
                        addListDiv.removeChild(addListDiv.firstChild);
                    }
                    let addList = document.createElement('ul')

                    addListDiv.appendChild(addList)
                    addList.classList.add('list-group')

                    data.features.forEach((address) => {
                        let newLi = document.createElement('li');
                        newLi.classList.add('list-group');
                        newLi.classList.add('list-group-item')
                        newLi.innerHTML = address.properties.label;

                        addList.appendChild(newLi);

                        console.log((address.properties.label));
                    })

                    if(data.features.length === 0) {
                        console.log('no results')

                        let noRes = docment.createElement('p');
                        noRes.innerHTML = 'No results found!'
                    }

                }

                request.send()
            }

        }

    </script>
{% endblock content %}

